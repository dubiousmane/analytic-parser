"""
config.py

Здесь собраны ВСЕ правила и константы проекта.
Файл не содержит логики — только настройки.
"""

import re

# ------------------------------------------------------------
# Допустимые типы операций
# ------------------------------------------------------------
KNOWN_OPERATIONS = {
    "Покупка",
    "Перевод",
    "Платеж",
    "Другое",
    "Снятие",
    "Пополнение",
    "Разное",
}

# ------------------------------------------------------------
# Ключевые слова для классификации переводов
# ------------------------------------------------------------
SELF_KEYWORDS = [
 "XXX"
]

FAMILY_KEYWORDS = [
    "XXX",
]

# ------------------------------------------------------------
# Маркеры футтера (Freedom)
# ------------------------------------------------------------
FOOTER_MARKERS = [
    "подлинность справки",
    "можете проверить",
    "qr-код",
    "qr код",
    "bankffin.kz",
    "check-receipt",
]

# ------------------------------------------------------------
# Мусорные паттерны
# ------------------------------------------------------------
NOISE_PATTERNS = [
    r"https?://\S+",
    r"\bСумма в\b",
    r"\bобработке\b",
]

# ------------------------------------------------------------
# REGEX
# ------------------------------------------------------------

# Новая операция начинается с даты
DATE_START_RE = re.compile(r"^\d{2}\.\d{2}\.\d{4}\b")

# Заголовок операции (поддержка +, -, ₸, $)
TX_HEAD_RE = re.compile(
    r"""
    ^(?P<date>\d{2}\.\d{2}\.\d{4})
    \s+
    (?P<amount>[+\-−]?\d[\d\s.,]*)     # сумма с + / -
    \s*([₸$])?                         # символ валюты
    \s+
    (?P<currency>KZT|USD)              # код валюты
    \s+
    (?P<operation>[А-Яа-яA-Za-z]+)     # тип операции
    (?:\s+(?P<details>.*))?
    $
    """,
    re.VERBOSE
)

# ------------------------------------------------------------
# Категории расходов (приоритет сверху вниз)
# ------------------------------------------------------------
CATEGORIES = [
    ("Зарплата жены", [
        r"ҚАДЫРБЕКОВА АЛТЫН",
    ]),
    ("Доход / пополнение", [
        r"ПОПОЛНЕНИЕ",
    ]),
    ("Переводы", [
        r"ПЕРЕВОД",
    ]),
    ("Такси", [
        r"ТАКСИ",
        r"UBER",
        r"YANDEX[ .]?GO",
    ]),
    ("Курьер / доставка", [
        r"YANDEX[ .]?DELIVERY",
    ]),
    ("Кафе / рестораны / кофейни", [
        r"BLACK BROWN",
        r"DACHA",
        r"ZEBRA",
        r"DRINKIT",
        r"HODZHABAEVA",
        r"FRUIT REPUBLIC",
    ]),
    ("Еда", [
        r"WOLT",
        r"GLOVO",
        r"YANDEX[ .]?EDA",
        r"YANDEX[ .]?LAVKA",
        r"ARBUZ",
        r"SHUKRAN",
        r"BAY ZHENIS",
        r"AISARA",
        r"DIMART",
        r"MANGO",
        r"MARKET",
        r"ROOTS",
    ]),
    ("Подписки", [
        r"CHATGPT",
        r"OPENAI",
    ]),
    ("Самолет", [
        r"AVIATA",
        r"FLY[ ]?ARYSTAN",
    ]),
    ("Игры", [
        r"STEAM",
        r"FUNPAY",
    ]),
    ("Техника", [
        r"SULPAK",
        r"OZON",
    ]),
    ("Медицина", [
        r"PHARM",
        r"BIOSFERA",
        r"MED",
        r"GINEKOLOGIC",
        r"DARMED",
        r"ATLANT",
        r"INVIVO",
    ]),
    ("Парфюмерия", [
        r"PERFUME LAND",
    ]),
    ("Цветы", [
        r"SAFI FLOWERS",
    ]),
]

ADAPTIVE_LIMITS = {
    "default_cut_percent": 10,   # −10% от привычного
    "warning_threshold": 0.8,    # 80% лимита
}
